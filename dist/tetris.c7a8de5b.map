{"version":3,"sources":["tetris.js"],"names":["a","b","c","d","e","f","g","tiles","Tetris","w","h","t","_init","prototype","constructor","self","_translateX","layout","fill","Array","map","i","v","j","n","totalScore","_zero","_bind","clearInterval","timer","delta","work","running","nextTileObj","_getRandTileObj","next","tile","row","col","getNextTile","tmp","rand","length","slice","_mix","fn","_minus","call","_add","_render","m","Math","max","start","nextRow","nextCol","emit","pad","toString","setInterval","_isAllowed","_clear","fullNum","maxFullNumber","trim","splice","unshift","on","type","eventQueue","push","bind","arg","arguments","forEach","apply","detach","pause","restart","render","res","substring","document","code","keyCode","left","rotate","right","down","fall","bak","_rotate","_shift","some","rotatedTile","window","arr","p","num","str","len","join","round","random","obj","addEventListener"],"mappings":"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","file":"tetris.c7a8de5b.map","sourceRoot":"..","sourcesContent":[";(function() {\n\tvar a = [ [4, 14], [4, 6, 4], [0, 14, 4], [4, 12, 4] ];\n\tvar b = [ [4, 4, 6], [0, 14, 8], [12, 4, 4], [2, 14] ];\n\tvar c = [ [4, 4, 12], [8, 14], [6, 4, 4], [0, 14, 2] ];\n\tvar d = [ [6, 6] ];\n\tvar e = [ [12, 6], [4, 12, 8] ];\n\tvar f = [ [6, 12], [4, 6, 2] ];\n\tvar g = [ [4, 4, 4, 4], [0, 15] ];\n\n\tvar tiles = [a, b, c, d, e, f, g, a, b, c, d, e, f, g];\n\n\tvar Tetris = function(w, h, t) {\n\t\tthis.w = w || 10;\n\t\tthis.h = h || 20;\n\t\tthis.t = t || 500;\n\t\tthis._init();\n\t};\n\n\tTetris.prototype = {\n\t\tconstructor: Tetris,\n\n\t\t_init: function() {\n\t\t\tvar self = this;\n\t\t\tthis._translateX = ~~(this.w/2) - 1;\n\t\t\tthis.layout = fill(new Array(this.h), 0);\n\t\t\tthis.tiles = tiles.map(function(e, i) {\n\t\t\t\treturn e.map(function(v, j) {\n\t\t\t\t\treturn v.map(function(n) {\n\t\t\t\t\t\treturn n << self._translateX;\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tthis.tiles;\n\n\t\t\tthis.totalScore = 0;\n\n\t\t\tthis._zero();\n\t\t\tthis._bind();\n\t\t},\n\n\t\t_zero: function() {\n\t\t\tclearInterval( this.timer );\n\t\t\tthis.delta = 0;\n\t\t\tthis.work = true;\n\t\t\tthis.n = -1;\n\n\t\t\tthis.running = false;\n\n\t\t\tif(!this.nextTileObj) this.nextTileObj = this._getRandTileObj();\n\t\t\tvar next = this.nextTileObj\n\t\t\tthis.tile = next.tile;\n\t\t\tthis.row = next.row;\n\t\t\tthis.col = next.col;\n\n\t\t\tthis.nextTileObj = this._getRandTileObj();\n\t\t},\n\n\t\tgetNextTile: function() {\n\t\t\treturn this.nextTileObj.tile;\n\t\t},\n\n\t\t_getRandTileObj: function() {\n\t\t\tvar row, col, tile;\n\t\t\tvar tmp = this.tiles[row = rand(0, this.tiles.length - 1)];\n\t\t\tvar tile = tmp[col = rand(0, tmp.length - 1)].slice(0);\n\t\t\treturn { row: row, col: col, tile: tile }\n\t\t},\n\n\t\t_mix: function(fn) {\n\t\t\tif( fn ) {\n\t\t\t\tthis._minus(); fn.call(this); this._add(); this._render();\n\t\t\t}\n\t\t},\n\n\t\t_add: function() {\n\t\t\tvar a = this.tile.length + this.n;\n\t\t\tif(a < 1 || a > this.layout.length) return false;\n\t\t\tfor(var i = 0, m = this.tile.length; i < m; i++)\n\t\t\t\tif(i + this.n >= 0)\n\t\t\t\t\tthis.layout[i + this.n] += this.tile[i];\n\t\t},\n\n\t\t_minus: function() {\n\t\t\tvar a = this.tile.length + this.n;\n\t\t\tif(a < 1 || a > this.layout.length) return false;\n\t\t\tfor(var i = 0, m = this.tile.length; i < m; i++)\n\t\t\t\tif(i + this.n >= 0)\n\t\t\t\t\tthis.layout[i + this.n] = Math.max(this.layout[i + this.n] - this.tile[i], 0);\n\t\t},\n\n\t\tstart: function(t) {\n\t\t\tif(this.running) return;\n\t\t\tthis.running = true;\n\n\t\t\tvar nextRow = this.nextTileObj.row, nextCol = this.nextTileObj.col;\n\t\t\tthis.emit('start', tiles[nextRow][nextCol].map(function(e) {\n\t\t\t\treturn pad(e.toString(2), 4)\n\t\t\t}) );\n\n\t\t\tvar self = this;\n\t\t\tthis.timer = setInterval(function() {\n\t\t\t\tif( self.work === true ) {\n\t\t\t\t\tself._mix(function() {\n\t\t\t\t\t\tself.n++;\n\t\t\t\t\t\tif( !this._isAllowed() ) {\n\t\t\t\t\t\t\tself.n--;\n\t\t\t\t\t\t\tself.work = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else if( self.work === false ) {\n\t\t\t\t\tclearInterval( self.timer );\n\t\t\t\t\tthis.running = false;\n\n\t\t\t\t\tif( self.n <= 0 ) {\n\t\t\t\t\t\tself._clear();\n\t\t\t\t\t\tself.emit('lose');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar fullNum = 0;\n\t\t\t\t\t\tvar maxFullNumber = ( 1 << self.w ) - 1;\n\t\t\t\t\t\tfor(var i = 0, m = self.layout.length; i < m; i++) {\n\t\t\t\t\t\t\tif( trim(self.layout[i]) >= maxFullNumber ) {\n\t\t\t\t\t\t\t\tfullNum++;\n\t\t\t\t\t\t\t\tself.layout.splice(i, 1);\n\t\t\t\t\t\t\t\tself.layout.unshift(0);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif(fullNum) {\n\t\t\t\t\t\t\tself.totalScore += fullNum;\n\t\t\t\t\t\t\tself.emit('score', self.totalScore, fullNum)\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tself._zero();\n\t\t\t\t\t\tself.start();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, this.t);\n\t\t\treturn this;\n\t\t},\n\n\t\ton: function(type, fn) {\n\t\t\tif( !this.eventQueue ) this.eventQueue = {};\n\t\t\tif( !this.eventQueue[type] ) this.eventQueue[type] = [];\n\n\t\t\tif(fn)\n\t\t\t\tthis.eventQueue[type].push(fn.bind(this));\n\t\t\treturn this;\n\t\t},\n\n\t\temit: function(type) {\n\t\t\tvar arg = Array.prototype.slice.call(arguments, 1);\n\n\t\t\tif( this.eventQueue && this.eventQueue[type] )\n\t\t\t\tthis.eventQueue[type].forEach(function(e) { e.apply(null, arg); });\n\t\t\treturn this;\n\t\t},\n\n\t\tdetach: function(type) {\n\t\t\tif( type && this.eventQueue[type]) this.eventQueue[type].length = 0;\n\t\t},\n\n\t\tpause: function() {\n\t\t\tclearInterval(this.timer);\n\t\t\tif(this.running === false) return;\n\t\t\tthis.running = false;\n\t\t\tthis.emit('pause');\n\t\t\treturn this;\n\t\t},\n\n\t\trestart: function(t) {\n\t\t\tthis.layout = fill(new Array(this.h), 0);\n\t\t\tthis._zero();\n\t\t\tthis.start(t);\n\t\t\treturn this;\n\t\t},\n\n\t\t_clear: function() {\n\t\t\tthis.layout = fill(new Array(this.h), 0);\n\t\t\tthis._render();\n\t\t},\n\n\t\t_render: function() {\n\t\t\tvar self = this;\n\t\t\tif( this.eventQueue && this.eventQueue.render && this.eventQueue.render.length ) {\n\t\t\t\tvar res = this.layout.map(function(e) {\n\t\t\t\t\treturn pad(e.toString(2), self.w + 2).substring(1, self.w + 1)\n\t\t\t\t});\n\t\t\t\tthis.emit('render', res);\n\t\t\t}\n\t\t},\n\n\t\t_bind: function() {\n\t\t\tvar self = this;\n\t\t\tbind(document, 'keydown', function(e) {\n\t\t\t\tvar code = e.keyCode;\n\t\t\t\tif( code === 37 )\n\t\t\t\t\tself.left();\n\t\t\t\telse if( code === 38 )\n\t\t\t\t\tself.rotate();\n\t\t\t\telse if( code === 39 )\n\t\t\t\t\tself.right();\n\t\t\t\telse if( code === 40 )\n\t\t\t\t\tself.down();\n\t\t\t\telse if( code === 32 )\n\t\t\t\t\tself.fall();\n\t\t\t});\n\t\t},\n\n\t\trotate: function() {\n\t\t\tif( !this.work || !this.running ) return;\n\t\t\tif( this.tile[this.row] === d ) return;\n\t\t\tvar bak = this.tile;\n\t\t\tthis._mix(function() {\n\t\t\t\tthis._rotate();\n\t\t\t\tif( !this._isAllowed() )\n\t\t\t\t\tthis.tile = bak;\n\t\t\t});\n\t\t},\n\n\t\tleft: function() {\n\t\t\tthis._shift(-1);\n\t\t},\n\n\t\tright: function() {\n\t\t\tthis._shift(1);\n\t\t},\n\n\t\t_shift: function(n) {\n\t\t\tif( !this.work || !this.running ) return;\n\t\t\tvar bak = this.tile;\n\t\t\tthis._mix(function() {\n\t\t\t\tthis.tile = this.tile.map(function(e) {\n\t\t\t\t\treturn n > 0 ? e >> n : e << -n;\n\t\t\t\t});\n\t\t\t\tthis._isAllowed() ? this.delta += n : this.tile = bak;\n\t\t\t});\n\t\t},\n\n\t\tdown: function() {\n\t\t\tif( !this.work || !this.running ) return;\n\t\t\tthis._mix(function() {\n\t\t\t\tthis.n++;\n\t\t\t\tif( !this._isAllowed() ) {\n\t\t\t\t\tthis.n--;\n\t\t\t\t\tthis.work = false;\n\t\t\t\t}\n\t\t\t})\n\t\t},\n\n\t\tfall: function() {\n\t\t\tif( !this.work || !this.running ) return;\n\t\t\tif( this.n < 0 ) return;\n\t\t\tthis._mix(function() {\n\t\t\t\twhile( this.n <= this.layout.length - this.tile.length ) {\n\t\t\t\t\tthis.n++;\n\t\t\t\t\tif( !this._isAllowed() ) {\n\t\t\t\t\t\tthis.n--;\n\t\t\t\t\t\tthis.work = false;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\t_isAllowed: function() {\n\t\t\tvar a = this.tile.length + this.n;\n\n\t\t\tif( a < 1 || a > this.layout.length ) return false;\n\n\t\t\tvar max = 1 << (this.w + 1);\n\t\t\tif( this.tile.some(function(e) { return (e >= max) || (e & 1) }) )\n\t\t\t\treturn false;\n\t\t\tfor(var i = 0, m = this.tile.length; i < m; i++)\n\t\t\t\tif( (this.tile[i] & (this.layout[i + this.n] || 0)) > 0 )\n\t\t\t\t\treturn false;\n\t\t\treturn true;\n\t\t},\n\n\t\t_rotate: function() {\n\t\t\tvar rotatedTile = this.tiles[this.row][++this.col] || (this.col = 0, this.tiles[this.row][0]);\n\t\t\tvar self = this;\n\t\t\tthis.tile = rotatedTile.map(function(e) {\n\t\t\t\treturn self.delta > 0 ? e >> self.delta : e << -self.delta;\n\t\t\t});\n\t\t}\n\n\t}\n\n\twindow.Tetris = Tetris;\n\n\tfunction fill(arr, p) {\n\t\tfor(var i = 0; i < arr.length; i++) arr[i] = p;\n\t\treturn arr;\n\t}\n\n\tfunction trim(num) {\n\t\tvar max = (1 << (num.toString(2).length - 1) ) - 1;\n\t\treturn (num >> 1) & max;\n\t}\n\n\tfunction pad(str, n) {\n\t\tvar len = str.length;\n\t\treturn len < n ? fill(new Array(n - len), '0').join('') + str : str.substring(len - n);\n\t}\n\n\tfunction rand(a, b) {\n\t\tif(a == null) a = 0;\n\t\tif(b == null) b = 8;\n\t\treturn Math.round(a + Math.random()*(b - a));\n\t}\n\n\tfunction bind(obj, type, fn) {\n\t\treturn obj.addEventListener(type, fn, false);\n\t}\n\n})();"]}